/*! aheuichem 2015-06-22 */

!function a(a,b,c){function d(e,j){if(!b[e]){if(!a[e]){var h="function"==typeof require&&require;if(!j&&h)return h(e,!0);if(f)return f(e,!0);var i=new Error("Cannot find module '"+e+"'");throw i.code="MODULE_NOT_FOUND",i}var g=b[e]={exports:{}};a[e][0].call(g.exports,function(b){var c=a[e][1][b];return d(c?c:b)},g,g.exports,a,a,b,c)}return b[e].exports}for(var f="function"==typeof require&&require,e=0;e<c.length;e++)d(c[e]);return d}({1:[function(c,b,d){function a(a,f,d,e){for(this.layers=[],this.layersByName={},this.layerContexts=[],this.layerContextsByName={},this.width=d,this.height=e,this.viewport=a,a.style.position="relative",a.style.width=d+"px",a.style.height=e+"px";a.firstChild;)a.removeChild(a.firstChild);for(var c=0;c<f.length;++c){var g=f[c],b=document.createElement("canvas");b.width=d,b.height=e,b.style.position="absolute";var h=b.getContext("2d");this.layers[c]=b,this.layersByName[g]=b,this.layerContexts[c]=h,this.layerContextsByName[g]=h,a.appendChild(b)}}a.prototype.setSize=function(c,d){this.viewport.style.width=this.width+"px",this.viewport.style.height=this.height+"px";for(var a=0;a<this.layers.length;++a){var b=this.layers[a];b.width=c,b.height=d}},a.prototype.get=function(a){return this.layerContextsByName[a]},a.prototype.getCanvas=function(a){return this.layersByName[a]},a.prototype.forEach=function(a,b){this.layerContexts.forEach(a,b)},a.prototype.canvasForEach=function(a,b){this.layers.forEach(a,b)},a.prototype.dump=function(a){var b=a.getContext("2d");a.width=this.width,a.height=this.height,this.canvasForEach(function(a){b.drawImage(a,0,0)})},b.exports=a},{}],2:[function(c,a,d){var b={initial:"ㄱㄲㄴㄷㄸㄹㅁㅂㅃㅅㅆㅇㅈㅉㅊㅋㅌㅍㅎ".split(""),medial:"ㅏㅐㅑㅒㅓㅔㅕㅖㅗㅘㅙㅚㅛㅜㅝㅞㅟㅠㅡㅢㅣ".split(""),"final":" ㄱㄲㄳㄴㄵㄶㄷㄹㄺㄻㄼㄽㄾㄿㅀㅁㅂㅄㅅㅆㅇㅈㅊㅋㅌㅍㅎ".split(""),code:44032};a.exports=b},{}],3:[function(b,i,j){var a,c,d,e=(b("./parser"),b("./renderer")),f=b("./interpreter"),g=b("./predictor"),h=b("./hangul");window.onload=function(){document.getElementById("codeForm").onsubmit=function(){var h=document.getElementById("codeForm-code").value;a=new f(h);var i=a.map.width*a.map.height*2;d=new g(a.map);for(var b=0;i>b&&d.next();++b);return d.updated=[],c=new e(document.getElementById("viewport"),a),window.interpreter=a,window.predictor=d,document.getElementById("codeForm-output").value="",!1},setInterval(function(){a&&c&&(c.preNext(),a.next(),c.postNext(),document.getElementById("codeForm-output").value+=a.shift(),document.getElementById("codeForm-debug").value=function(){var b="",c=a.state;if(c.running){var e=c.direction;b+="실행 중 (위치 "+c.x+", "+c.y+") ",b+="(방향 "+e.x+", "+e.y+")\n"}else b+="실행 끝\n";for(var d=0;28>d;++d)c.selected==d&&(b+=">> "),b+=h["final"][d]+": ",b+=c.memory[d].data.join(" "),b+="\n";return b}())},20),document.getElementById("captureBtn").onclick=function(){c.canvases.dump(document.getElementById("capture"))}}},{"./hangul":2,"./interpreter":4,"./parser":6,"./predictor":7,"./renderer":8}],4:[function(k,r,t){function c(a){return{data:2,exec:function(e,f,b){var c=b.pull(),d=b.pull();b.push(a(c,d))}}}function b(a){"string"==typeof a?this.map=s.parse(a):this.map=a,this.reset()}function n(b,a){return 1e3==a?b:-1e3==a?-b:a}function o(c,g){var b=0;return-1>=g&&(b|=a),g>=1&&(b|=f),-1>=c&&(b|=e),c>=1&&(b|=d),b}function g(a,c,b){return a+=c,0>a&&(a=b+a),a>=b&&(a-=b),a}function h(a){return a>0?1:0>a?-1:0}function i(a,b){null!=a&&(null==a.directions&&(a.directions={}),null==a.directions[b]&&(a.directions[b]={segment:0}))}var s=k("./parser"),j=k("./memory"),q={up:{x:0,y:-1},left:{x:-1,y:0},right:{x:1,y:0},down:{x:0,y:1},"skip-up":{x:0,y:-2},"skip-left":{x:-2,y:0},"skip-right":{x:2,y:0},"skip-down":{x:0,y:2},horizontal:{x:1e3,y:-1e3},vertical:{x:-1e3,y:1e3},reverse:{x:-1e3,y:-1e3},none:{x:1e3,y:1e3}},p={end:{data:0,exec:function(b,a,c){a.running=!1}},add:c(function(a,b){return b+a}),multiply:c(function(a,b){return b*a}),subtract:c(function(a,b){return b-a}),divide:c(function(a,b){return b/a|0}),mod:c(function(a,b){return b%a}),pop:{data:1,exec:function(b,c,a){a.pull()}},"pop-unicode":{data:1,exec:function(d,a,b){var c=b.pull();a.output.push(String.fromCharCode(c))}},"pop-number":{data:1,exec:function(d,a,b){var c=b.pull();a.output=a.output.concat(String(c).split(""))}},push:{data:0,exec:function(a,c,b){b.push(a.data)}},"push-unicode":{data:0,exec:function(b,c,a){a.push(44032)}},"push-number":{data:0,exec:function(b,c,a){a.push(123)}},copy:{data:1,exec:function(b,c,a){a.copy()}},flip:{data:2,exec:function(b,c,a){a.flip()}},select:{data:0,exec:function(a,b,c){b.selected=a.data}},move:{data:1,exec:function(a,b,c){var d=b.memory[a.data],e=c.pull();d.push(e)}},compare:{data:2,exec:function(d,e,a){var b=a.pull(),c=a.pull();a.push(c>=b?1:0)}},condition:{data:1,exec:function(c,d,a){var b=a.pull();return 0==b?!0:void 0}}},a=1,f=2,e=4,d=8,m={up:a,down:f,left:e,right:d,horizontal:e|d,vertical:a|f,"up-left":a|e,"down-left":f|e,"up-right":a|d,"down-right":f|d},l={};Object.keys(m).forEach(function(a){l[m[a]]=a}),b.prototype.push=function(a){},b.prototype.shift=function(){var a=this.state.output.join("");return this.state.output=[],a},b.prototype.reset=function(){this.state={x:0,y:0,direction:{x:0,y:1},memory:{},selected:0,input:[],output:[],running:!0},this.updated=[];for(var a=0;28>a;++a)switch(a){case 21:this.state.memory[a]=new j.Queue;break;case 28:this.state.memory[a]=new j.Stack;break;default:this.state.memory[a]=new j.Stack}},b.prototype.next=function(){if(!this.state.running)return!1;var a=this.state.direction;a.x=h(a.x),a.y=h(a.y);var r=o(-a.x,-a.y),b=this.map.get(this.state.x,this.state.y);if(null!=b){var d=q[b.direction];a.x=n(a.x,d.x),a.y=n(a.y,d.y);var s=this.state.selected,f=this.state.memory[s],k=!1,c=p[b.command];c&&(k=f.canPull(c.data)?!!c.exec(b,this.state,f):!0)}if(!this.state.running)return!1;if(k&&(a.x*=-1,a.y*=-1),Math.abs(a.x)>=2||Math.abs(a.y)>=2){var m=g(this.state.x,h(a.x),this.map.width),j=g(this.state.y,h(a.y),this.map.height),e=this.map.get(m,j);this.updated.push({x:m,y:j}),a.x?i(e,"skip-horizontal"):i(e,"skip-vertical")}this.updated.push({x:this.state.x,y:this.state.y});var t=r|o(a.x,a.y);return i(b,l[t]),this.state.x=g(this.state.x,a.x,this.map.width),this.state.y=g(this.state.y,a.y,this.map.height),this.state.running},r.exports=b},{"./memory":5,"./parser":6}],5:[function(e,d,f){function a(){}function b(){this.data=[]}function c(){this.data=[]}a.prototype.push=function(a){},a.prototype.pull=function(){},a.prototype.canPull=function(a){},a.prototype.copy=function(){},a.prototype.flip=function(){},b.prototype.push=function(a){this.data.push(a)},b.prototype.pull=function(){return this.data.pop()},b.prototype.canPull=function(a){return this.data.length>=a},b.prototype.copy=function(){if(!this.canPull(1))return!1;var a=this.pull();return this.data.push(a),this.data.push(a),!0},b.prototype.flip=function(){if(!this.canPull(2))return!1;var a=this.pull(),b=this.pull();return this.data.push(a),this.data.push(b),!0},c.prototype.push=function(a){this.data.push(a)},c.prototype.pull=function(){return this.data.shift()},c.prototype.canPull=function(a){return this.data.length>=a},c.prototype.copy=function(){if(!this.canPull(1))return!1;var a=this.data[0];return this.data.unshift(a),!0},c.prototype.flip=function(){if(!this.canPull(2))return!1;var a=this.pull(),b=this.pull();return this.data.unshift(b),this.data.unshift(a),!0},d.exports.Memory=a,d.exports.Stack=b,d.exports.Queue=c},{}],6:[function(f,d,o){function m(a){return a>=44032&&55203>=a}function i(h){var d={direction:"none",command:"none",original:h},f=h.charCodeAt();if(!m(f))return d;f-=a.code;var i=f%a["final"].length,g=a["final"][i];f=f/a["final"].length|0;var j=f%a.medial.length,k=a.medial[j];f=f/a.medial.length|0;var l=f%a.initial.length,n=a.initial[l];return d.direction=e[k]||d.direction,d.command=c[n]||d.command,"push"==d.command&&("ㅇ"==g?d.command="push-number":"ㅎ"==g?d.command="push-unicode":d.data=b[g]),"pop"==d.command&&("ㅇ"==g?d.command="pop-number":"ㅎ"==g&&(d.command="pop-unicode")),("select"==d.command||"move"==d.command)&&(d.data=i),d}function l(b){var d=h[b.command],f=g[b.direction],c=" ";"push-number"==b.command?(d="ㅂ",c="ㅇ"):"push-unicode"==b.command?(d="ㅂ",c="ㅎ"):"push"==b.command?c=j[b.data]:"pop-number"==b.command?(d="ㅁ",c="ㅇ"):"pop-unicode"==b.command?(d="ㅁ",c="ㅎ"):("select"==b.command||"move"==b.command)&&(c=a["final"][b.data]);var i=a.initial.indexOf(d),k=a.medial.indexOf(f),l=a["final"].indexOf(c),e=a.code;return e+=i*a.medial.length*a["final"].length,e+=k*a["final"].length,e+=l,String.fromCharCode(e)}function k(f){for(var c=f.split("\n"),d=new n(0,c.length),a=0;a<c.length;++a){var e=c[a].split("");d.expand(e.length,0);for(var b=0;b<e.length;++b)d.set(b,a,i(e[b]))}return d}var n=f("./tilemap"),a=f("./hangul"),e={"ㅗ":"up","ㅓ":"left","ㅏ":"right","ㅜ":"down","ㅛ":"skip-up","ㅕ":"skip-left","ㅑ":"skip-right","ㅠ":"skip-down","ㅡ":"horizontal","ㅣ":"vertical","ㅢ":"reverse","ㅐ":"none"},g={};Object.keys(e).forEach(function(a){g[e[a]]=a});var c={"ㅇ":"none","ㅎ":"end","ㄷ":"add","ㄸ":"multiply","ㅌ":"subtract","ㄴ":"divide","ㄹ":"mod","ㅁ":"pop","ㅂ":"push","ㅃ":"copy","ㅍ":"flip","ㅅ":"select","ㅆ":"move","ㅈ":"compare","ㅊ":"condition"},h={};Object.keys(c).forEach(function(a){h[c[a]]=a});var b={" ":0,"ㄱ":2,"ㄴ":2,"ㄷ":3,"ㄹ":5,"ㅁ":4,"ㅂ":4,"ㅅ":2,"ㅈ":3,"ㅊ":4,"ㅋ":3,"ㅌ":4,"ㅍ":4,"ㄲ":4,"ㄳ":4,"ㄵ":5,"ㄶ":5,"ㄺ":7,"ㄻ":9,"ㄼ":9,"ㄽ":7,"ㄾ":9,"ㄿ":9,"ㅀ":8,"ㅄ":6,"ㅆ":4},j={};Object.keys(b).forEach(function(a){j[b[a]]=a}),d.exports.parseSyllable=i,d.exports.parse=k,d.exports.encodeSyllable=l},{"./hangul":2,"./tilemap":9}],7:[function(s,p,u){function l(a){"string"==typeof a?this.map=q.parse(a):this.map=a,this.segmentId=0,this.segments={},this.stack=[{x:0,y:0,direction:{x:0,y:1},register:{x:0,y:0,preDir:0}}],this.updated=[]}function j(d,e,c,p,k,j,f){var q=e.get(d.x,d.y);if(o(c.x,c.y)){var l=a(d.x,g(c.x),e.width),m=a(d.y,g(c.y),e.height),n=e.get(l,m);k.push({x:l,y:m}),c.x?h(n,"skip-horizontal",j,f):h(n,"skip-vertical",j,f)}k.push({x:d.x,y:d.y});var r=p|b(c.x,c.y);h(q,i[r],j,f)}function k(b,a){return 1e3==a?b:-1e3==a?-b:a}function o(a,b){return Math.abs(a)>=2||Math.abs(b)>=2}function b(b,g){var a=0;return-1>=g&&(a|=c),g>=1&&(a|=d),-1>=b&&(a|=e),b>=1&&(a|=f),a}function a(a,c,b){return a+=c,0>a&&(a=b+a),a>=b&&(a-=b),a}function g(a){return a>0?1:0>a?-1:0}function h(a,b,c,d){null!=a&&(null==a.directions&&(a.directions={}),null==a.directions[b]&&(a.directions[b]={segment:c,unlikely:d}))}var q=s("./parser"),n={up:{x:0,y:-1},left:{x:-1,y:0},right:{x:1,y:0},down:{x:0,y:1},"skip-up":{x:0,y:-2},"skip-left":{x:-2,y:0},"skip-right":{x:2,y:0},"skip-down":{x:0,y:2},horizontal:{x:1e3,y:-1e3},vertical:{x:-1e3,y:1e3},reverse:{x:-1e3,y:-1e3},none:{x:1e3,y:1e3}},c=1,d=2,e=4,f=8,m={up:c,down:d,left:e,right:f,horizontal:e|f,vertical:c|d,"up-left":c|e,"down-left":d|e,"up-right":c|f,"down-right":d|f},i={};Object.keys(m).forEach(function(a){i[m[a]]=a});var r={condition:!0,pop:!0,add:!0,multiply:!0,subtract:!0,divide:!0,mod:!0,pop:!0,"pop-unicode":!0,"pop-number":!0,copy:!0,flip:!0,move:!0,compare:!0},t={add:!0,multiply:!0,subtract:!0,divide:!0,mod:!0,pop:!0,"pop-unicode":!0,"pop-number":!0,copy:!0,flip:!0,move:!0,compare:!0};l.prototype.next=function(){if(0==this.stack.length)return!1;var c=this.stack[this.stack.length-1];c.register&&(c.segment=this.segmentId++,this.segments[c.segment]=[],c.register.preDir&&j({x:c.register.x,y:c.register.y},this.map,c.direction,c.register.preDir,this.updated,c.segment,c.unlikely),delete c.register);var f=this.segments[c.segment],d=c.direction;d.x=g(d.x),d.y=g(d.y);var p=b(-d.x,-d.y),e=this.map.get(c.x,c.y),m=!1;if(f&&f.push(e),null!=e){e.segments||(e.segments={});var s=n[e.direction];if(d.x=k(d.x,s.x),d.y=k(d.y,s.y),"end"==e.command&&(m=!0),e.segments[b(d.x,d.y)]?m=!0:e.segments[b(d.x,d.y)]={segment:c.segment,position:f?f.length-1:0},r[e.command]){var h={x:-d.x,y:-d.y},i={x:a(c.x,h.x,this.map.width),y:a(c.y,h.y,this.map.height),direction:h,unlikely:c.unlikely,register:{x:c.x,y:c.y,preDir:p}},l=this.map.get(i.x,i.y),q=!1;if(l){var o=n[l.direction];o.x==d.x&&o.y==d.y&&(q=!0)}q||l&&l.segments&&l.segments[b(h.x,h.y)]||(t[e.command]?(i.unlikely=!0,this.stack.unshift(i)):this.stack.push(i))}}return j(c,this.map,d,p,this.updated,c.segment,c.unlikely),c.x=a(c.x,d.x,this.map.width),c.y=a(c.y,d.y,this.map.height),m&&(this.stack.splice(this.stack.indexOf(c),1),f&&f.length<=1&&delete this.segments[c.segment]),this.stack.length>0},p.exports=l},{"./parser":6}],8:[function(b,f,l){function c(a,b,c,e,f,d,h,g){"undefined"==typeof g&&(g=!0),"undefined"==typeof d&&(d=5),a.beginPath(),a.moveTo(b+d,c),a.lineTo(b+e-d,c),a.quadraticCurveTo(b+e,c,b+e,c+d),a.lineTo(b+e,c+f-d),a.quadraticCurveTo(b+e,c+f,b+e-d,c+f),a.lineTo(b+d,c+f),a.quadraticCurveTo(b,c+f,b,c+f-d),a.lineTo(b,c+d),a.quadraticCurveTo(b,c,b+d,c),a.closePath(),g&&a.stroke(),h&&a.fill()}var d=b("./tilemap"),e=b("./canvaslayer"),k=b("./hangul"),g={up:[2,0],left:[2,1],right:[3,0],down:[3,1],"skip-up":[2,2],"skip-left":[2,3],"skip-right":[3,2],"skip-down":[3,3],none:[0,0],horizontal:[1,0],vertical:[1,1],reverse:[0,1]},h={up:[2,1],left:[1,2],right:[3,0],down:[2,2],"up-left":[1,1],"up-right":[0,2],"down-left":[2,0],"down-right":[0,0],horizontal:[1,0],vertical:[0,1],"skip-horizontal":[3,1],"skip-vertical":[3,2]},i=[[0,0],[1,0],[0,1],[1,1]],j={none:[0,0],end:[1,0],add:[2,0],multiply:[3,0],subtract:[2,1],divide:[3,1],mod:[1,1],push:[0,1],"push-unicode":[4,1],"push-number":[4,0],pop:[0,2],"pop-unicode":[4,3],"pop-number":[4,2],copy:[1,2],flip:[2,2],select:[3,2],move:[0,3],compare:[1,3],condition:[2,3]},a=function(h,a,i){function b(){g--,0==g&&j.reset()}this.interpreter=a,this.width=i||48,this.canvases=new e(h,["background","highlight","text","path","arrow","command"],this.width*a.map.width,this.width*a.map.height);var g=3,j=this,c=new Image;c.src="img/path.svg",c.onload=b,this.pathImage=c;var d=new Image;d.src="img/arrow.svg",d.onload=b,this.arrowImage=d;var f=new Image;f.src="img/command.svg",f.onload=b,this.commandImage=f};a.prototype.reset=function(){this.cacheMap=new d(this.interpreter.map.width,this.interpreter.map.height),this.canvases.setSize(this.width*this.interpreter.map.width,this.width*this.interpreter.map.height),this.canvases.forEach(function(a){a.font=.6*this.width+"px sans-serif",a.textAlign="center",a.textBaseline="middle",a.fillStyle="#000"},this),this.canvases.get("background").fillRect(0,0,this.canvases.width,this.canvases.height),this.canvases.get("text").fillStyle="#555";for(var a=0;a<this.interpreter.map.height;++a)for(var b=0;b<this.interpreter.map.width;++b)this.cacheMap.set(b,a,{}),this.updateTile(b,a)},a.prototype.updateTile=function(f,l){var m=this.interpreter.state,a=this.interpreter.map.get(f,l),b=this.cacheMap.get(f,l);if(a){this.canvases.forEach(function(a){a.save(),a.translate(f*this.width,l*this.width)},this);var e=this.canvases.get("highlight");if(e.clearRect(0,0,this.width,this.width),m&&m.x==f&&m.y==l?e.fillStyle="#666":a.called?e.fillStyle="#333":e.fillStyle="#222",c(e,1,1,this.width-2,this.width-2,4,!0),b.text!=a.original){b.text=a.original;var s=this.canvases.get("text");s.clearRect(0,0,this.width,this.width),s.fillText(a.original,this.width/2,this.width/2)}if(a.directions&&b.directions!=Object.keys(a.directions).length){b.directions=Object.keys(a.directions).length,this.canvases.get("path").clearRect(0,0,this.width,this.width);for(var n in a.directions){var o=i[a.directions[n].segment%4],p=h[n];this.canvases.get("path").globalAlpha=a.directions[n].unlikely?.2:1,this.canvases.get("path").drawImage(this.pathImage,100*(4*o[0]+p[0]),100*(3*o[1]+p[1]),100,100,0,0,this.width,this.width)}}if(b.direction!=a.direction){b.direction=a.direction;var q=this.canvases.get("arrow");q.clearRect(0,0,this.width,this.width);var r=g[a.direction];q.drawImage(this.arrowImage,100*r[0],100*r[1],100,100,0,0,this.width,this.width)}if(b.command!=a.command){b.command=a.command;var d=this.canvases.get("command"),t=j[a.command];if(d.drawImage(this.commandImage,100*t[0],100*t[1],100,100,0,0,this.width,this.width),null!=a.data){var u=a.data;"push"!=a.command&&(u=k["final"][a.data]),d.font=.3*this.width+"px sans-serif",d.textAlign="right",d.textBaseline="bottom",d.fillStyle="#fff",d.fillText(u,this.width-3,this.width-3)}}this.canvases.forEach(function(a){a.restore()},this)}},a.prototype.preNext=function(){},a.prototype.postNext=function(){for(var a=this.interpreter.state;this.interpreter.updated.length>0;){var b=this.interpreter.updated.shift();this.updateTile(b.x,b.y)}a&&this.updateTile(a.x,a.y)},f.exports=a},{"./canvaslayer":1,"./hangul":2,"./tilemap":9}],9:[function(c,b,d){function a(a,b){this.width=a,this.height=b,this.map=null,this.clear()}a.prototype.clear=function(){this.map=[];for(var a=0;a<this.height;++a){for(var c=[],b=0;b<this.width;++b)c[b]=null;this.map[a]=c}},a.prototype.expand=function(d,e){var g=this.width,f=this.height;d>this.width&&(this.width=d),e>this.height&&(this.height=e);for(var a=0;f>a;++a)for(var c=this.map[a],b=g;b<this.width;++b)c[b]=null;for(var a=f;a<this.height;++a){for(var c=[],b=0;b<this.width;++b)c[b]=null;this.map[a]=c}},a.prototype.get=function(a,b){return 0>b||b>=this.height?null:0>a||a>=this.width?null:this.map[b][a]},a.prototype.set=function(a,b,c){if(0>b||b>=this.height)throw new Error("TileMap out of bounds");if(0>a||a>=this.width)throw new Error("TileMap out of bounds");this.map[b][a]=c},b.exports=a},{}]},{},[3]);
//# sourceMappingURL=aheuichem.min.js.map