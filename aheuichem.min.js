/*! aheuichem 2015-07-20 */

!function a(a,b,c){function d(e,j){if(!b[e]){if(!a[e]){var h="function"==typeof require&&require;if(!j&&h)return h(e,!0);if(f)return f(e,!0);var i=new Error("Cannot find module '"+e+"'");throw i.code="MODULE_NOT_FOUND",i}var g=b[e]={exports:{}};a[e][0].call(g.exports,function(b){var c=a[e][1][b];return d(c?c:b)},g,g.exports,a,a,b,c)}return b[e].exports}for(var f="function"==typeof require&&require,e=0;e<c.length;e++)d(c[e]);return d}({1:[function(b,c,f){function a(a,b,c,d,e,f,g){this.tile=a,this.key=d,this.data=e,this.tileX=b,this.tileY=c,this.renderer=f,this.callback=g}var d=b("./parser"),e=b("./interpreter");a.prototype.exec=function(){this.before=this.tile[this.key],this.tile[this.key]=this.data,this.update()},a.prototype.undo=function(){this.tile[this.key]=this.before,this.update()},a.prototype.update=function(){var a=e.CommandMap[this.tile.command];null!=a&&a.argument&&null==this.tile.data&&(this.tile.data=0),"push"==this.tile.command&&this.tile.data>9&&(this.tile.data=0),this.tile.original=d.encodeSyllable(this.tile),this.renderer.map.set(this.tileX,this.tileY,this.tile),this.renderer.updateTile(this.tileX,this.tileY),this.callback&&this.callback()},c.exports=a},{"./interpreter":7,"./parser":11}],2:[function(c,b,d){function a(a,f,d,e){for(this.layers=[],this.layersByName={},this.layerContexts=[],this.layerContextsByName={},this.width=d,this.height=e,this.viewport=a,a.style.position="relative",a.style.width=d+"px",a.style.height=e+"px";a.firstChild;)a.removeChild(a.firstChild);for(var c=0;c<f.length;++c){var g=f[c],b=document.createElement("canvas");b.width=d,b.height=e,b.style.position="absolute";var h=b.getContext("2d");this.layers[c]=b,this.layersByName[g]=b,this.layerContexts[c]=h,this.layerContextsByName[g]=h,a.appendChild(b)}}a.prototype.setSize=function(a,b){this.viewport.style.width=a+"px",this.viewport.style.height=b+"px",this.width=a,this.height=b;for(var c=0;c<this.layers.length;++c){var d=this.layers[c];d.width=a,d.height=b}},a.prototype.get=function(a){return this.layerContextsByName[a]},a.prototype.getCanvas=function(a){return this.layersByName[a]},a.prototype.forEach=function(a,b){this.layerContexts.forEach(a,b)},a.prototype.canvasForEach=function(a,b){this.layers.forEach(a,b)},a.prototype.dump=function(a){var b=a.getContext("2d");a.width=this.width,a.height=this.height,this.canvasForEach(function(a){b.drawImage(a,0,0)})},b.exports=a},{}],3:[function(b,k,o){function c(a,b,c,d,e,f,g,h){this.container=a,this.element=b,this.pushElement=c,this.finalElement=d,this.hideEvent=this.hide.bind(this),this.init(),this.renderer=e,this.clickCallback=f,this.keyboard=g,this.undomachine=h,this.tileX=null,this.tileY=null,this.tile=null}var e=b("./table"),f=b("./tilemap"),a=b("./keyboard"),i=b("./hangul"),d=(b("./parser"),b("./action")),j=[[{name:"복사",exec:function(){}},{name:"자르기",exec:function(){}},{name:"붙이기",exec:function(){}},{name:"중단점",exec:function(){this.undomachine.run(new d(this.tile,this.tileX,this.tileY,"breakpoint",!this.tile.breakpoint,this.renderer))}}]],h=[[0,2,3,4,5],[6,7,8,9]],g=[" ㄱㄴㄷㄹㄲㄳㄵㄶ".split(""),"ㅁㅂㅅㅇㅈㄺㄻㄼㄽ".split(""),"ㅊㅋㅌㅍㅎㄾㄿㅀㅄㅆ".split("")],l=a.createKeyMap(j,a.KeyNumberLayout),m=a.createKeyMap(h),n=a.createKeyMap(g);c.prototype.update=function(){this.clickCallback&&this.clickCallback(this.tileX,this.tileY,this.tile)},c.prototype.init=function(){var b=this,c=f.fromArray(h),k=document.getElementById("push-table"),c=(new e(k,c,function(c,e,g,h){if(null==e)return void c.parentNode.removeChild(c);c.id="push-table-"+e,c.appendChild(document.createTextNode(e));var f=document.createElement("div");f.className="key",f.appendChild(document.createTextNode(a.KeyLayout[h][g])),c.appendChild(f),c.addEventListener("click",function(){b.undomachine.run(new d(b.tile,b.tileX,b.tileY,"data",e,b.renderer)),b.update()})}),f.fromArray(g)),k=document.getElementById("final-table"),c=(new e(k,c,function(c,e,g,h){if(null==e)return void c.parentNode.removeChild(c);c.id="final-table-"+e,c.appendChild(document.createTextNode(e));var f=document.createElement("div");f.className="key",f.appendChild(document.createTextNode(a.KeyShiftLayout[h][g])),c.appendChild(f),c.addEventListener("click",function(){b.undomachine.run(new d(b.tile,b.tileX,b.tileY,"data",i["final"].indexOf(e),b.renderer)),b.update()})}),f.fromArray(j)),k=document.getElementById("utility-table");new e(k,c,function(c,d,f,g){if(null==d)return void c.parentNode.removeChild(c);c.id="utility-table-"+d,c.appendChild(document.createTextNode(d.name));var e=document.createElement("div");e.className="key",e.appendChild(document.createTextNode(a.KeyNumberLayout[g][f])),c.appendChild(e),c.addEventListener("click",function(){d.exec.call(b),b.update()})})},c.prototype.show=function(b,c){var a=this;this.container.style.display="block",this.container.addEventListener("click",this.hideEvent),this.container.addEventListener("contextmenu",this.hideEvent),this.element.style.display="block",setTimeout(function(){a.element.style.top=c+"px",a.element.style.left=Math.max(0,b-a.element.offsetWidth/2+a.renderer.width/2)+"px"},0);var a=this;this.keyboard.push(null),this.keyboard.push({map:l,callback:function(b){b.exec.call(a),a.update(),a.hide()}}),"push"==this.tile.command?(this.finalElement.style.display="none",this.pushElement.style.display="block",this.keyboard.push({map:m,callback:function(b){a.undomachine.run(new d(a.tile,a.tileX,a.tileY,"data",b,a.renderer)),a.update(),a.hide()}})):(this.finalElement.style.display="block",this.pushElement.style.display="none",this.keyboard.push({map:n,callback:function(b){a.undomachine.run(new d(a.tile,a.tileX,a.tileY,"data",i["final"].indexOf(b),a.renderer)),a.update(),a.hide()}}))},c.prototype.hide=function(a){return this.container.removeEventListener("click",this.hideEvent),this.container.removeEventListener("contextmenu",this.hideEvent),this.container.style.display="none",this.element.style.display="none",this.keyboard.pop(),this.keyboard.pop(),this.keyboard.pop(),a?(a.preventDefault(),!1):void 0},k.exports=c},{"./action":1,"./hangul":5,"./keyboard":8,"./parser":11,"./table":17,"./tilemap":18}],4:[function(u,p,t){function r(a,d,b,n,h,e){var p=d.get(a.x,a.y);if(o(b.x,b.y)){var k=c(a.x,j(b.x),d.width),l=c(a.y,j(b.y),d.height),m=d.get(k,l);h.push({x:k,y:l}),b.x?f(m,"skip-horizontal",e):f(m,"skip-vertical",e)}h.push({x:a.x,y:a.y});var q=n|i(b.x,b.y);f(p,g[q],e),a.x=c(a.x,b.x,d.width),a.y=c(a.y,b.y,d.height)}function j(a){return a>0?1:0>a?-1:0}function o(a,b){return Math.abs(a)>=2||Math.abs(b)>=2}function q(b,a){return 1e3==a?b:-1e3==a?-b:a}function c(a,c,b){return a+=c,0>a&&(a=b+a),a>=b&&(a-=b),a}function i(f,g,h){var c=0;return h&&-2==g?k:h&&2==g?l:h&&-2==f?m:h&&2==f?n:(-1>=g&&(c|=e),g>=1&&(c|=a),-1>=f&&(c|=d),f>=1&&(c|=b),c)}function f(a,c,b){-1!=b&&null!=a&&(null==a.directions&&(a.directions=[]),null==a.directions[b]&&(a.directions[b]=[]),-1==a.directions[b].indexOf(c)&&a.directions[b].push(c))}var s={up:{x:0,y:-1},left:{x:-1,y:0},right:{x:1,y:0},down:{x:0,y:1},"skip-up":{x:0,y:-2},"skip-left":{x:-2,y:0},"skip-right":{x:2,y:0},"skip-down":{x:0,y:2},horizontal:{x:1e3,y:-1e3},vertical:{x:-1e3,y:1e3},reverse:{x:-1e3,y:-1e3},none:{x:1e3,y:1e3}},e=1,a=2,d=4,b=8,k=16,l=32,m=64,n=128,h={up:e,down:a,left:d,right:b,horizontal:d|b,vertical:e|a,"up-left":e|d,"down-left":a|d,"up-right":e|b,"down-right":a|b,"skip-up":k,"skip-down":l,"skip-left":m,"skip-right":n},g={};Object.keys(h).forEach(function(a){g[h[a]]=a}),p.exports={map:s,bitMap:h,bitRevMap:g,process:r,calculate:q,move:c,convertToBits:i,write:f}},{}],5:[function(c,a,d){var b={initial:"ㄱㄲㄴㄷㄸㄹㅁㅂㅃㅅㅆㅇㅈㅉㅊㅋㅌㅍㅎ".split(""),medial:"ㅏㅐㅑㅒㅓㅔㅕㅖㅗㅘㅙㅚㅛㅜㅝㅞㅟㅠㅡㅢㅣ".split(""),"final":" ㄱㄲㄳㄴㄵㄶㄷㄹㄺㄻㄼㄽㄾㄿㅀㅁㅂㅄㅅㅆㅇㅈㅊㅋㅌㅍㅎ".split(""),code:44032};a.exports=b},{}],6:[function(c,A,B){function n(f){if(!f&&b)for(var c=0;c<a.map.height;++c)for(var d=0;d<a.map.width;++d){var e=a.map.get(d,c),i=b.cacheMap.get(d,c);e&&(e.directions=[],e.segments={},i.directions={})}var j=a.map.width*a.map.height*80;g=new q(a.map);for(var h=0;j>h&&g.next();++h);g.postCheck(),!f&&b&&b.redraw(),window.predictor=g}function m(c){c||(a.reset(),b.reset()),document.getElementById("codeForm-output").value="",a.push(document.getElementById("codeForm-input").value),e.running=!1,document.activeElement.blur()}function t(){return l?(j.renderer=b,h.renderer=b,f.renderer=b,e.renderer=b,void(e.interpreter=a)):(d=new z,e=new y(a,b,function(){document.getElementById("codeForm-output").value+=a.shift(),document.getElementById("codeForm-debug").value=k.getStatus()},m.bind(this,!1)),j=new p(b),f=new x(document.getElementById("context-bg"),document.getElementById("context"),document.getElementById("context-push"),document.getElementById("context-final"),b),h=new w(document.getElementById("viewport"),j,b,f,d),h.checkCallback=function(){return!e.running},h.clickCallback=n.bind(this,!1),i=new o,i.push({map:{z:function(){d.undo()},y:function(){d.redo()}," ":function(){e.running=!e.running}},callback:function(a){a()}}),i.push({map:o.EditorKeyMapping,callback:function(a){j.changeSelected(a[0],a[1])}}),f.keyboard=i,f.undomachine=d,void(l=!0))}var a,b,g,k,j,h,f,e,i,d,v=c("./parser"),r=c("./renderer"),s=c("./interpreter"),q=c("./predictor"),u=c("./monitor"),p=c("./toolbox"),w=c("./viewport"),x=c("./contextmenu"),y=c("./playback"),o=c("./keyboard"),z=c("./undomachine"),l=!1;window.onload=function(){document.getElementById("codeForm").onsubmit=function(){var c=document.getElementById("codeForm-code").value;return a=new s(c),k=new u(a),n(!0),b=new r(document.getElementById("canvas"),a),t(),d.reset(),window.undomachine=d,window.interpreter=a,window.predictor=g,m(!0),!1},document.getElementById("codeForm-export").onclick=function(){document.getElementById("codeForm-code").value=v.encode(a.map)}}},{"./contextmenu":3,"./interpreter":7,"./keyboard":8,"./monitor":10,"./parser":11,"./playback":12,"./predictor":13,"./renderer":14,"./toolbox":19,"./undomachine":20,"./viewport":21}],7:[function(d,g,i){function b(a){return{data:2,output:1,exec:function(e,f,b){var c=b.pull(),d=b.pull();b.push(a(c,d))}}}function a(a){"string"==typeof a?this.map=h.parse(a):this.map=a,this.reset()}var h=d("./parser"),e=d("./memory"),c=d("./direction"),f={end:{data:0,output:0,exec:function(b,a,c){a.running=!1}},add:b(function(a,b){return b+a}),multiply:b(function(a,b){return b*a}),subtract:b(function(a,b){return b-a}),divide:b(function(a,b){return b/a|0}),mod:b(function(a,b){return b%a}),pop:{data:1,output:0,exec:function(b,c,a){a.pull()}},"pop-unicode":{data:1,output:0,exec:function(d,a,b){var c=b.pull();a.output.push(String.fromCharCode(c))}},"pop-number":{data:1,output:0,exec:function(d,a,b){var c=b.pull();a.output=a.output.concat(String(c).split(""))}},push:{data:0,output:1,argument:!0,exec:function(a,c,b){b.push(a.data)}},"push-unicode":{data:0,output:1,exec:function(d,c,a){var b=c.input.shift();null==b?a.push(-1):a.push(b.charCodeAt(0))}},"push-number":{data:0,output:1,exec:function(f,b,c){for(var a="";b.input.length;){var d=b.input[0];if(/[0-9-+]/.test(d))a+=d,b.input.shift();else{if(a.length>0)break;a="",b.input.shift()}}if(a.length>0){var e=parseInt(a);c.push(e)}else c.push(-1)}},copy:{data:1,output:2,exec:function(b,c,a){a.copy()}},flip:{data:2,output:2,exec:function(b,c,a){a.flip()}},select:{data:0,output:0,argument:!0,exec:function(a,b,c){b.selected=a.data}},move:{data:1,output:0,argument:!0,exec:function(a,b,c){var d=b.memory[a.data],e=c.pull();d.push(e)}},compare:{data:2,output:1,exec:function(d,e,a){var b=a.pull(),c=a.pull();a.push(c>=b?1:0)}},condition:{data:1,output:0,exec:function(c,d,a){var b=a.pull();return 0===b?!0:void 0}}};a.prototype.push=function(a){this.state.input=this.state.input.concat(a.split(""))},a.prototype.shift=function(){var a=this.state.output.join("");return this.state.output=[],a},a.prototype.reset=function(){this.state={x:0,y:0,direction:{x:0,y:1},memory:{},selected:0,input:[],output:[],running:!0},this.updated=[];for(var a=0;28>a;++a)switch(a){case 21:this.state.memory[a]=new e.Queue;break;case 28:this.state.memory[a]=new e.Stack;break;default:this.state.memory[a]=new e.Stack}},a.prototype.next=function(){if(!this.state.running)return!1;var a=this.state.direction,i=c.convertToBits(-a.x,-a.y),b=this.map.get(this.state.x,this.state.y),e=!1;if(null!==b){var g=c.map[b.direction];a.x=c.calculate(a.x,g.x),a.y=c.calculate(a.y,g.y);var j=this.state.selected,h=this.state.memory[j],d=f[b.command];d&&(e=h.canPull(d.data)?!!d.exec(b,this.state,h):!0)}if(!this.state.running)return!1;e&&(a.x*=-1,a.y*=-1),c.process(this.state,this.map,a,i,this.updated,-1);var k=this.map.get(this.state.x,this.state.y);return this.state.breakpoint=k.breakpoint,this.state.running},a.CommandMap=f,g.exports=a},{"./direction":4,"./memory":9,"./parser":11}],8:[function(g,c,h){function a(){this.stack=[],this.registerEvents()}var d=["1234567890"].map(function(a){return a.split("")}),e=["qwert","asdfg","zxcvb"].map(function(a){return a.split("")}),b=["qwertQWERT","asdfgASDFG","zxcvbZXCVBN"].map(function(a){return a.split("")}),f={q:["arrow","none"],w:["arrow","up"],e:["command","none"],r:["command","select"],t:["command","move"],a:["arrow","left"],s:["arrow","down"],d:["arrow","right"],f:["command","push"],g:["command","pop"],z:["command","subtract"],x:["command","divide"],c:["command","add"],v:["command","multiply"],b:["command","mod"],Q:["arrow","reverse"],W:["arrow","skip-up"],E:["command","end"],R:["command","condition"],T:["command","compare"],A:["arrow","skip-left"],S:["arrow","skip-down"],D:["arrow","skip-right"],F:["command","copy"],G:["command","flip"],Z:["arrow","horizontal"],X:["arrow","vertical"],C:["command","pop-number"],V:["command","pop-unicode"],B:["command","push-unicode"],N:["command","push-number"]};a.prototype.push=function(a){this.stack.push(a)},a.prototype.pop=function(){return this.stack.pop()},a.prototype.registerEvents=function(){var a=this;document.addEventListener("keypress",function(d){for(var c=d.key||String.fromCharCode(d.charCode),e=a.stack.length-1;e>=0;--e){var b=a.stack[e];if(d.ctrlKey&&(b=a.stack[0]),b&&b.map){if(void 0!=b.map[c])return void b.callback(b.map[c]);if(void 0!=b.map[c.toUpperCase()])return void b.callback(b.map[c.toUpperCase()])}}})},a.KeyNumberLayout=d,a.KeyLayout=e,a.KeyShiftLayout=b,a.EditorKeyMapping=f,a.createKeyMap=function(d,e){null==e&&(e=b);for(var f={},a=0;a<d.length;++a)for(var c=0;c<d[a].length;++c)f[e[a][c]]=d[a][c];return f},c.exports=a},{}],9:[function(e,d,f){function a(){}function b(){this.data=[]}function c(){this.data=[]}a.prototype.push=function(a){},a.prototype.pull=function(){},a.prototype.canPull=function(a){},a.prototype.copy=function(){},a.prototype.flip=function(){},b.prototype.push=function(a){this.data.push(a)},b.prototype.pull=function(){return this.data.pop()},b.prototype.canPull=function(a){return this.data.length>=a},b.prototype.copy=function(){if(!this.canPull(1))return!1;var a=this.pull();return this.data.push(a),this.data.push(a),!0},b.prototype.flip=function(){if(!this.canPull(2))return!1;var a=this.pull(),b=this.pull();return this.data.push(a),this.data.push(b),!0},c.prototype.push=function(a){this.data.push(a)},c.prototype.pull=function(){return this.data.shift()},c.prototype.canPull=function(a){return this.data.length>=a},c.prototype.copy=function(){if(!this.canPull(1))return!1;var a=this.data[0];return this.data.unshift(a),!0},c.prototype.flip=function(){if(!this.canPull(2))return!1;var a=this.pull(),b=this.pull();return this.data.unshift(b),this.data.unshift(a),!0},d.exports.Memory=a,d.exports.Stack=b,d.exports.Queue=c},{}],10:[function(b,c,e){function a(a){this.interpreter=a}var d=b("./hangul");a.prototype.getStatus=function(){var a="",b=this.interpreter.state;if(b.running){b.direction;a+="실행 중 (위치 "+b.x+", "+b.y+")\n"}else a+="실행 끝\n";for(var c=0;28>c;++c)b.selected==c&&(a+=">> "),a+=d["final"][c]+": ",a+=b.memory[c].data.join(" "),a+="\n";return a},c.exports=a},{"./hangul":5}],11:[function(j,e,q){function o(a){return a>=44032&&55203>=a}function i(h){var c={direction:"none",command:"none",original:h},d=h.charCodeAt();if(!o(d))return c;d-=a.code;var i=d%a["final"].length,e=a["final"][i];d=d/a["final"].length|0;var j=d%a.medial.length,k=a.medial[j];d=d/a.medial.length|0;var l=d%a.initial.length,m=a.initial[l];return c.direction=g[k]||c.direction,c.command=f[m]||c.command,"push"==c.command&&("ㅇ"==e?c.command="push-number":"ㅎ"==e?c.command="push-unicode":c.data=b[e]),"pop"==c.command&&("ㅇ"==e?c.command="pop-number":"ㅎ"==e&&(c.command="pop-unicode")),("select"==c.command||"move"==c.command)&&(c.data=i),c}function n(b){var f=d(h[b.command]),i=d(k[b.direction]),e=" ";"push-number"==b.command?(f="ㅂ",e="ㅇ"):"push-unicode"==b.command?(f="ㅂ",e="ㅎ"):"push"==b.command?e=d(c[b.data||0]):"pop-number"==b.command?(f="ㅁ",e="ㅇ"):"pop-unicode"==b.command?(f="ㅁ",e="ㅎ"):("select"==b.command||"move"==b.command)&&(e=d(a["final"][b.data||0]));var j=a.initial.indexOf(f),l=a.medial.indexOf(i),m=a["final"].indexOf(e),g=a.code;return g+=j*a.medial.length*a["final"].length,g+=l*a["final"].length,g+=m,String.fromCharCode(g)}function m(a){for(var b="",c=0;c<a.height;++c){for(var d=0;d<a.width;++d){var e=a.get(d,c);b+=e?e.original:"ㅇ"}b+="\n"}return b.slice(0,-1)}function d(a){return a.charAt(a.length*Math.random()|0)}function p(f){for(var c=f.split("\n"),d=new l(0,c.length),a=0;a<c.length;++a){var e=c[a].split("");d.expand(e.length,0);for(var b=0;b<e.length;++b)d.set(b,a,i(e[b]))}return d}var l=j("./tilemap"),a=j("./hangul"),g={"ㅗ":"up","ㅓ":"left","ㅏ":"right","ㅜ":"down","ㅛ":"skip-up","ㅕ":"skip-left","ㅑ":"skip-right","ㅠ":"skip-down","ㅡ":"horizontal","ㅣ":"vertical","ㅢ":"reverse","ㅐㅔㅒㅖㅘㅙㅚㅝㅞㅟ":"none"},k={};Object.keys(g).forEach(function(a){k[g[a]]=a});var f={"ㅇㄱㄲㅉㅋ":"none","ㅎ":"end","ㄷ":"add","ㄸ":"multiply","ㅌ":"subtract","ㄴ":"divide","ㄹ":"mod","ㅁ":"pop","ㅂ":"push","ㅃ":"copy","ㅍ":"flip","ㅅ":"select","ㅆ":"move","ㅈ":"compare","ㅊ":"condition"},h={};Object.keys(f).forEach(function(a){h[f[a]]=a});var b={" ":0,"ㄱ":2,"ㄴ":2,"ㄷ":3,"ㄹ":5,"ㅁ":4,"ㅂ":4,"ㅅ":2,"ㅈ":3,"ㅊ":4,"ㅋ":3,"ㅌ":4,"ㅍ":4,"ㄲ":4,"ㄳ":4,"ㄵ":5,"ㄶ":5,"ㄺ":7,"ㄻ":9,"ㄼ":9,"ㄽ":7,"ㄾ":9,"ㄿ":9,"ㅀ":8,"ㅄ":6,"ㅆ":4},c={};Object.keys(b).forEach(function(a){null==c[b[a]]&&(c[b[a]]=""),c[b[a]]+=a}),e.exports.parseSyllable=i,e.exports.parse=p,e.exports.encodeSyllable=n,e.exports.encode=m},{"./hangul":5,"./tilemap":18}],12:[function(c,b,d){function a(a,b,c,d){this.interpreter=a,this.renderer=b,this.callback=c,this.resetCallback=d,this.running=!1,this.registerEvents()}a.prototype.registerEvents=function(){var a=this;document.getElementById("codeForm-resume").onclick=function(){document.activeElement.blur(),a.running=!0},document.getElementById("codeForm-pause").onclick=function(){document.activeElement.blur(),a.running=!1},document.getElementById("codeForm-step").onclick=function(){document.activeElement.blur(),a.step(),a.running=!1},document.getElementById("codeForm-reset").onclick=function(){a.resetCallback()},setInterval(function(){a.running&&a.step()},20)},a.prototype.step=function(){this.interpreter&&this.renderer&&(this.interpreter.next(),this.renderer.render(),this.interpreter.state.breakpoint&&(this.running=!1),this.interpreter.state.running||(this.running=!1),this.callback&&this.callback())},b.exports=a},{}],13:[function(d,f,j){function b(a){this.id=a.id,this.segment=a.segment,this.x=a.x,this.y=a.y,this.direction={},this.direction.x=a.direction.x,this.direction.y=a.direction.y,this.selected=a.selected,this.memory=a.memory.slice(),this.seek=a.seek||!1,this.merge=!0,this.visit=0}function c(a){"string"==typeof a?this.map=g.parse(a):this.map=a,this.reset(),this.updated=[]}var g=d("./parser"),h=d("./tilemap"),a=d("./direction"),e=d("./interpreter");b.init=function(){for(var a=[],c=0;28>c;++c)a.push(0);return new b({id:0,segment:0,x:0,y:0,direction:{x:0,y:1},selected:0,memory:a})},b.prototype.diff=function(a){return this.memory.map(function(b,c){return b-a.memory[c]})},c.prototype.reset=function(){this.segments=[],this.mergeCandidates=[],this.stack=[],this.headingMap=new h(this.map.width,this.map.height);var a=b.init(),c=[];c.push(a),this.segments.push(c),this.stack.push(a)},c.prototype.postCheck=function(){for(;this.mergeCandidates.length;){var c=this.mergeCandidates.shift();if(c.merge){for(var h=this.segments[c.segment];c.otherwiseSet.length;){var f=c.otherwiseSet.shift(),e=this.segments[f.segment],d=c.direction,g=a.convertToBits(-d.x,-d.y);if(!(c.segment>=f.segment)){0==e.length&&e.push(f);for(var b;e.length;)b=e.shift(),b.segment=c.segment,b.id=h.length,h.push(b),b.before&&a.process({x:b.before.x,y:b.before.y},this.map,b.direction,g,this.updated,b.segment),d=b.direction,g=a.convertToBits(-d.x,-d.y)}}b.then&&a.process({x:b.x,y:b.y},this.map,b.then.direction,g,this.updated,b.segment),c.merge=!1}}},c.prototype.next=function(){if(0===this.stack.length)return!1;var g=this.stack.pop(),c=new b(g);c.before=g,c.seek||(g.then=c);var m=this.segments[c.segment],d=c.direction,l=a.convertToBits(-d.x,-d.y),f=this.map.get(c.x,c.y),h=this.headingMap.get(c.x,c.y);null==h&&(h={},this.headingMap.set(c.x,c.y,h));var n=!1,k=!1;if(null!=f){var o=a.map[f.direction];d.x=a.calculate(d.x,o.x),d.y=a.calculate(d.y,o.y);var i=e.CommandMap[f.command];if(null!=i)if(c.memory[c.selected]>=i.data){if(c.memory[c.selected]-=i.data,c.memory[c.selected]+=i.output,"select"==f.command&&(c.selected=f.data),"move"==f.command&&c.memory[f.data]++,"end"==f.command&&(k=!0),"condition"==f.command){var j=new b(c);j.direction.x=-d.x,j.direction.y=-d.y,g.otherwise=j,this.processCursor(j,m,f,h,k,!0,l)}g.merge=!1}else d.x=-d.x,d.y=-d.y,n=!0,g.seek||(g.otherwiseSet||(g.otherwiseSet=[],this.mergeCandidates.push(g)),g.otherwiseSet.push(c))}return this.processCursor(c,m,f,h,k,n,l),this.stack.length>0},c.prototype.processCursor=function(b,g,m,f,i,j,l){var c,d=!1,h=b.direction,e=a.convertToBits(h.x,h.y,!0);if(f[e]){c=f[e],c.visit++;var k=!b.memory.every(function(d,e){var a=c.memory[e]-d;return 0>=a&&d>=8&&(b.memory[e]=8),c.visit>16?0>=a:0==a});c.memory=b.memory.slice(),d=k,k||(i=!0)}c&&j&&(b.id=c.id,b.segment=c.segment),i||(d||(j&&(b.id=-1,b.segment=this.segments.length,g=[],this.segments.push(g)),b.id++,g.push(b),f[e]=b),this.stack.push(b)),a.process(b,this.map,h,l,this.updated,b.segment,!1),c&&d&&(b.id=c.id,b.segment=c.segment),b.seek=d};var i={end:"halt",add:"add",multiply:"mul",subtract:"sub",divide:"div",mod:"mod",pop:"pop","pop-number":"popnum","pop-unicode":"popchar",push:"push","push-number":"pushnum","push-unicode":"pushchar",copy:"dup",flip:"swap",select:"sel",move:"mov",compare:"cmp",condition:"brz"};c.prototype.assembly=function(){for(var f=[],j=[],g=[],o=0;o<this.segments.length;++o)for(var l=this.segments[o],h=0;h<l.length;++h){var c=l[h];c.index=g.length;var p=this.headingMap.get(c.x,c.y),b=this.map.get(c.x,c.y);if(null!=b)if("none"!=b.command){var s=e.CommandMap[b.command],t=a.convertToBits(-c.direction.x,-c.direction.y,!0);if(p[t]&&s.data>0){var d=["brpop"+s.data,p[t]];g.push(d),f.push(d)}var d=[i[b.command]];"push"==b.command&&(d[1]=b.data),"select"==b.command&&(d[1]=b.data),"move"==b.command&&(d[1]=b.data),"condition"==b.command&&(d[1]=c.otherwise,f.push(d)),g.push(d)}else if(h==l.length-1){var r=a.map[b.direction],u=a.calculate(c.direction.x,r.x),v=a.calculate(c.direction.y,r.y),w=a.convertToBits(u,v,!0),q=p[w];if(!q)continue;var d=["jmp",q];g.push(d),f.push(d)}}for(var k=0;k<f.length;++k){var m=f[k][1].index;-1==j.indexOf(m)&&j.push(m),f[k][1]="p"+j.indexOf(m)}var n=[];g.forEach(function(b,c){var a=j.indexOf(c);-1!=a&&n.push(":p"+a),n.push(b.join(" "))}),console.log(n.join("\n"))},f.exports=c},{"./direction":4,"./interpreter":7,"./parser":11,"./tilemap":18}],14:[function(c,h,n){function f(a,b,c,e,f,d,h,g){"undefined"==typeof g&&(g=!0),"undefined"==typeof d&&(d=5),a.beginPath(),a.moveTo(b+d,c),a.lineTo(b+e-d,c),a.quadraticCurveTo(b+e,c,b+e,c+d),a.lineTo(b+e,c+f-d),a.quadraticCurveTo(b+e,c+f,b+e-d,c+f),a.lineTo(b+d,c+f),a.quadraticCurveTo(b,c+f,b,c+f-d),a.lineTo(b,c+d),a.quadraticCurveTo(b,c,b+d,c),a.closePath(),g&&a.stroke(),h&&a.fill()}var i=c("./tilemap"),m=c("./canvaslayer"),d=c("./hangul"),g=c("./spriteloader"),a=100,j={up:[2,0],left:[2,1],right:[3,0],down:[3,1],"skip-up":[2,2],"skip-left":[2,3],"skip-right":[3,2],"skip-down":[3,3],none:[0,0],horizontal:[1,0],vertical:[1,1],reverse:[0,1]},k={up:[2,1],left:[1,2],right:[3,0],down:[2,2],"up-left":[1,1],"up-right":[0,2],"down-left":[2,0],"down-right":[0,0],horizontal:[1,0],vertical:[0,1],"skip-horizontal":[3,1],"skip-vertical":[3,2]},l=[[0,0],[1,0],[0,1],[1,1],[0,2],[1,2]],e={none:[0,0],end:[1,0],add:[2,0],multiply:[3,0],subtract:[2,1],divide:[3,1],mod:[1,1],push:[0,1],"push-unicode":[4,1],"push-number":[4,0],pop:[0,2],"pop-unicode":[4,3],"pop-number":[4,2],copy:[1,2],flip:[2,2],select:[3,2],move:[0,3],compare:[1,3],condition:[2,3],breakpoint:[3,3]},b=function(b,a,c){var d=this;this.interpreter=a,this.map=a.map,this.width=c||50,this.canvases=new m(b,["background","highlight","text","path","arrow","command"],this.width*a.map.width,this.width*a.map.height),this.sprites=new g(function(){d.reset()}),this.sprites.load("path","img/path.png"),this.sprites.load("arrow","img/arrow.png"),this.sprites.load("command","img/command.png")};b.prototype.reset=function(){this.cacheMap=new i(this.interpreter.map.width,this.interpreter.map.height),this.canvases.setSize(this.width*this.interpreter.map.width,this.width*this.interpreter.map.height),this.canvases.forEach(function(a){a.font=.6*this.width+"px sans-serif",a.textAlign="center",a.textBaseline="middle",a.fillStyle="#000"},this),this.canvases.get("background").fillRect(0,0,this.canvases.width,this.canvases.height),this.canvases.get("text").fillStyle="#555";for(var a=0;a<this.interpreter.map.height;++a)for(var b=0;b<this.interpreter.map.width;++b)this.cacheMap.set(b,a,{}),this.updateTile(b,a)},b.prototype.redraw=function(){for(var a=0;a<this.interpreter.map.height;++a)for(var b=0;b<this.interpreter.map.width;++b)this.updateTile(b,a)},b.prototype.updateTile=function(i,o){var r=this.interpreter.state,b=this.interpreter.map.get(i,o),c=this.cacheMap.get(i,o);if(b){this.canvases.forEach(function(a){a.save(),a.translate(i*this.width,o*this.width)},this);var q=r&&r.x==i&&r.y==o;if(c.highlighted!=q){c.highlighted=q;var n=this.canvases.get("highlight");n.clearRect(0,0,this.width,this.width),q?n.fillStyle="#666":n.fillStyle="#222",f(n,1,1,this.width-2,this.width-2,4,!0)}if(c.text!=b.original){c.text=b.original;var v=this.canvases.get("text");v.clearRect(0,0,this.width,this.width),v.fillText(b.original,this.width/2,this.width/2)}if(b.directions&&c.directions!=Object.keys(b.directions).length){c.directions=Object.keys(b.directions).length,this.canvases.get("path").clearRect(0,0,this.width,this.width);for(var p=b.directions.length-1;p>=0;--p){var s=b.directions[p];null!=s&&s.forEach(function(d){var b=l[p%6],c=k[d],e=this.sprites.get("path");this.canvases.get("path").drawImage(e,(4*b[0]+c[0])*a,(3*b[1]+c[1])*a,a,a,0,0,this.width,this.width)},this)}}if(c.direction!=b.direction){c.direction=b.direction;var t=this.canvases.get("arrow");t.clearRect(0,0,this.width,this.width);var u=j[b.direction];t.drawImage(this.sprites.get("arrow"),u[0]*a,u[1]*a,a,a,0,0,this.width,this.width)}if(c.command!=b.command||c.data!=b.data||c.breakpoint!=b.breakpoint){c.command=b.command,c.data=b.data,c.breakpoint=b.breakpoint;var g=this.canvases.get("command"),h=e[b.command];if(g.clearRect(0,0,this.width,this.width),g.drawImage(this.sprites.get("command"),h[0]*a,h[1]*a,a,a,0,0,this.width,this.width),b.breakpoint&&(h=e.breakpoint,g.drawImage(this.sprites.get("command"),h[0]*a,h[1]*a,a,a,0,0,this.width,this.width)),null!=b.data){var m="";"push"==b.command&&(m=b.data),"select"==b.command&&(m=d["final"][b.data]),"move"==b.command&&(m=d["final"][b.data]),g.font=.3*this.width+"px sans-serif",g.textAlign="right",g.textBaseline="bottom",g.fillStyle="#fff",g.fillText(m,this.width-3,this.width-3)}}this.canvases.forEach(function(a){a.restore()},this)}},b.prototype.render=function(){for(var a=this.interpreter.state;this.interpreter.updated.length>0;){var b=this.interpreter.updated.shift();this.updateTile(b.x,b.y)}a&&this.updateTile(a.x,a.y)},h.exports=b},{"./canvaslayer":2,"./hangul":5,"./spriteloader":16,"./tilemap":18}],15:[function(c,b,d){function a(a,b){this.viewport=a,this.clickCallback=b,this.registerEvents(),this.tolerance=6}a.prototype.registerEvents=function(){function f(b){return document.removeEventListener("mouseup",f),document.removeEventListener("mousemove",g),Math.abs(d)<a.tolerance&&Math.abs(e)<a.tolerance&&a.clickCallback&&a.clickCallback(b),!1}function g(f){var g=f.pageX-b,h=f.pageY-c;a.viewport.scrollTop-=h,a.viewport.scrollLeft-=g,d-=g,e-=h,b=f.pageX,c=f.pageY}var a=this,b=0,c=0,d=0,e=0;this.viewport.addEventListener("mousedown",function(a){return b=a.pageX,c=a.pageY,d=0,e=0,document.addEventListener("mouseup",f),document.addEventListener("mousemove",g),a.preventDefault(),!1})},b.exports=a},{}],16:[function(c,b,d){function a(a){this.sprites=[],this.loadCount=0,this.callback=a}a.prototype.get=function(a){return this.sprites[a]},a.prototype.load=function(b,c){var a=new Image;a.src=c,a.onload=function(){this.sprites[b]=a,this.handleDone()}.bind(this),this.loadCount++},a.prototype.handleDone=function(){this.loadCount--,0==this.loadCount&&this.callback&&this.callback()},b.exports=a},{}],17:[function(b,c,e){function a(a,b,c){this.viewport=a,this.tilemap=b,this.updateCallback=c,this.reset()}var d=b("./tilemap");a.prototype.reset=function(){this.domMap=new d(this.tilemap.width,this.tilemap.height),this.createNodes()},a.prototype.createNodes=function(){for(;this.viewport.firstChild;)this.viewport.removeChild(this.viewport.firstChild);for(var a=0;a<this.domMap.height;++a){var d=document.createElement("tr");this.viewport.appendChild(d);for(var b=0;b<this.domMap.width;++b){var c=document.createElement("td");d.appendChild(c),c.tx=b,c.ty=a,this.domMap.set(b,a,c),this.updateNode(b,a)}}},a.prototype.updateNode=function(a,b){var c=this.domMap.get(a,b),d=this.tilemap.get(a,b);this.updateCallback(c,d,a,b)},c.exports=a},{"./tilemap":18}],18:[function(c,b,d){function a(a,b){this.width=a,this.height=b,this.map=null,this.clear()}a.prototype.clear=function(){this.map=[];for(var a=0;a<this.height;++a){for(var c=[],b=0;b<this.width;++b)c[b]=null;this.map[a]=c}},a.prototype.expand=function(d,e){var a,b,c,g=this.width,f=this.height;for(d>this.width&&(this.width=d),e>this.height&&(this.height=e),b=0;f>b;++b)for(c=this.map[b],a=g;a<this.width;++a)c[a]=null;for(b=f;b<this.height;++b){for(c=[],a=0;a<this.width;++a)c[a]=null;this.map[b]=c}},a.prototype.get=function(a,b){return 0>b||b>=this.height?null:0>a||a>=this.width?null:this.map[b][a]},a.prototype.set=function(a,b,c){if(0>b||b>=this.height)throw new Error("TileMap out of bounds");if(0>a||a>=this.width)throw new Error("TileMap out of bounds");this.map[b][a]=c},a.fromArray=function(c){for(var e=new a(0,c.length),b=0;b<c.length;++b){e.expand(c[b].length,0);for(var d=0;d<c[b].length;++d)e.set(d,b,c[b][d])}return e},b.exports=a},{}],19:[function(b,d,g){function c(a){this.selected={type:"arrow",name:"none"},this.oldNode=null,this.renderer=a,this.scrollPane=null,this.generateTable()}var a=b("./keyboard"),e=b("./tilemap"),f=b("./table");c.prototype.generateTable=function(){for(var g=this,b=new e(a.KeyShiftLayout[0].length,a.KeyShiftLayout.length),c=0;c<b.height;++c)for(var d=0;d<b.width;++d){var h=a.KeyShiftLayout[c][d];b.set(d,c,{value:a.EditorKeyMapping[h],key:h})}var i=document.getElementById("toolbox-table");this.table=new f(i,b,function(a,b){return b&&b.value?(a.id=b.value.join("-"),a.className=b.value[0],a.appendChild(document.createTextNode(b.key)),void a.addEventListener("click",function(){g.changeSelected.apply(g,b.value)})):void a.parentNode.removeChild(a)})},c.prototype.changeSelected=function(a,b){this.oldNode&&(this.oldNode.className=this.selected.type),this.selected.type=a,this.selected.name=b;var c=document.getElementById(a+"-"+b);c.className=a+" selected",this.oldNode=c},d.exports=c},{"./keyboard":8,"./table":17,"./tilemap":18}],20:[function(c,b,d){
function a(){this.undoStack=[],this.redoStack=[]}a.prototype.run=function(a){this.redoStack=[],a.exec(),this.undoStack.push(a)},a.prototype.canUndo=function(){return this.undoStack.length>=1},a.prototype.undo=function(){if(!this.canUndo())return!1;var a=this.undoStack.pop();return a.undo(),this.redoStack.push(a),a},a.prototype.canRedo=function(){return this.redoStack.length>=1},a.prototype.redo=function(){if(!this.canRedo())return!1;var a=this.redoStack.pop();return a.exec(),this.undoStack.push(a),a},a.prototype.reset=function(){this.undoStack=[],this.redoStack=[]},b.exports=a},{}],21:[function(b,d,f){function a(a,b,c,d,f,g,h){this.element=a,this.toolbox=b,this.renderer=c,this.contextmenu=d,this.undomachine=f,this.scrollpane=new e(a,this.handleMouseClick.bind(this)),this.checkCallback=g,this.clickCallback=h,this.hookEvents()}var e=b("./scrollpane"),c=b("./action");b("./parser");a.prototype.hookEvents=function(){this.element.addEventListener("contextmenu",this.handleContext.bind(this))},a.prototype.handleMouseClick=function(f){var h=0,g=0,k=0,j=0,d=this.element;do h+=d.offsetLeft-d.scrollLeft,g+=d.offsetTop-d.scrollTop,d=d.offsetParent;while(d);h+=this.renderer.canvases.viewport.offsetLeft,g+=this.renderer.canvases.viewport.offsetTop,h+=document.body.scrollLeft,g+=document.body.scrollTop,k=f.pageX-h,j=f.pageY-g,f.preventDefault();var a=k/this.renderer.width|0,b=j/this.renderer.width|0;if(!this.checkCallback(a,b))return!1;this.renderer.map.expand(a+1,b+1),(a+1>=this.renderer.map.width||b+1>=this.renderer.map.height)&&this.renderer.reset();var e=this.renderer.map.get(a,b)||{direction:"none",command:"none",original:" "};if(0==f.button){var i=this.toolbox.selected;"arrow"==i.type?this.undomachine.run(new c(e,a,b,"direction",i.name,this.renderer,this.clickCallback.bind(this,a,b,e))):this.undomachine.run(new c(e,a,b,"command",i.name,this.renderer,this.clickCallback.bind(this,a,b,e)))}else if(2==f.button){var l=a*this.renderer.width+h,m=(b+1)*this.renderer.width+g;this.contextmenu.tileX=a,this.contextmenu.tileY=b,this.contextmenu.tile=e,this.contextmenu.show(l,m)}},a.prototype.handleContext=function(a){return a.preventDefault(),!1},d.exports=a},{"./action":1,"./parser":11,"./scrollpane":15}]},{},[6]);
//# sourceMappingURL=aheuichem.min.js.map