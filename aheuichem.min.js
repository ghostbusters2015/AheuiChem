/*! aheuichem 2015-07-08 */

!function a(a,b,c){function d(e,j){if(!b[e]){if(!a[e]){var h="function"==typeof require&&require;if(!j&&h)return h(e,!0);if(f)return f(e,!0);var i=new Error("Cannot find module '"+e+"'");throw i.code="MODULE_NOT_FOUND",i}var g=b[e]={exports:{}};a[e][0].call(g.exports,function(b){var c=a[e][1][b];return d(c?c:b)},g,g.exports,a,a,b,c)}return b[e].exports}for(var f="function"==typeof require&&require,e=0;e<c.length;e++)d(c[e]);return d}({1:[function(c,b,d){function a(a,f,d,e){for(this.layers=[],this.layersByName={},this.layerContexts=[],this.layerContextsByName={},this.width=d,this.height=e,this.viewport=a,a.style.position="relative",a.style.width=d+"px",a.style.height=e+"px";a.firstChild;)a.removeChild(a.firstChild);for(var c=0;c<f.length;++c){var g=f[c],b=document.createElement("canvas");b.width=d,b.height=e,b.style.position="absolute";var h=b.getContext("2d");this.layers[c]=b,this.layersByName[g]=b,this.layerContexts[c]=h,this.layerContextsByName[g]=h,a.appendChild(b)}}a.prototype.setSize=function(a,b){this.viewport.style.width=a+"px",this.viewport.style.height=b+"px",this.width=a,this.height=b;for(var c=0;c<this.layers.length;++c){var d=this.layers[c];d.width=a,d.height=b}},a.prototype.get=function(a){return this.layerContextsByName[a]},a.prototype.getCanvas=function(a){return this.layersByName[a]},a.prototype.forEach=function(a,b){this.layerContexts.forEach(a,b)},a.prototype.canvasForEach=function(a,b){this.layers.forEach(a,b)},a.prototype.dump=function(a){var b=a.getContext("2d");a.width=this.width,a.height=this.height,this.canvasForEach(function(a){b.drawImage(a,0,0)})},b.exports=a},{}],2:[function(b,c,h){function a(a,b,c,d){this.container=a,this.element=b,this.hideEvent=this.hide.bind(this),this.init(),this.renderer=c,this.clickCallback=d,this.tileX=null,this.tileY=null,this.tile=null}var d=b("./table"),e=b("./tilemap"),f=b("./parser"),g=[[0,2,3,4,5],[6,7,8,9,-1]];a.prototype.update=function(){this.tile.original=f.encodeSyllable(this.tile),this.renderer.map.set(this.tileX,this.tileY,this.tile),this.renderer.updateTile(this.tileX,this.tileY),this.clickCallback&&this.clickCallback(this.tileX,this.tileY,this.tile)},a.prototype.init=function(){for(var f=this,a=new e(5,2),b=0;b<a.height;++b)for(var c=0;c<a.width;++c)a.set(c,b,g[b][c]);var h=document.getElementById("push-table");new d(h,a,function(a,b){return null==b?void a.parentNode.removeChild(a):(a.id="push-table-"+b,a.appendChild(document.createTextNode(b)),void a.addEventListener("click",function(){f.tile.data=b,f.update()}))})},a.prototype.show=function(a,b){this.container.style.display="block",this.container.addEventListener("click",this.hideEvent),this.container.addEventListener("contextmenu",this.hideEvent),this.element.style.display="block",this.element.style.top=b+"px",this.element.style.left=a+"px"},a.prototype.hide=function(a){return this.container.removeEventListener("click",this.hideEvent),this.container.removeEventListener("contextmenu",this.hideEvent),this.container.style.display="none",this.element.style.display="none",a?(a.preventDefault(),!1):void 0},c.exports=a},{"./parser":10,"./table":15,"./tilemap":16}],3:[function(q,l,p){function o(a,c,b,p,k,h,e){var q=c.get(a.x,a.y);if(n(b.x,b.y)){var l=d(a.x,i(b.x),c.width),m=d(a.y,i(b.y),c.height),o=c.get(l,m);k.push({x:l,y:m}),b.x?f(o,"skip-horizontal",h,e):f(o,"skip-vertical",h,e)}k.push({x:a.x,y:a.y});var r=p|j(b.x,b.y);f(q,g[r],h,e),a.x=d(a.x,b.x,c.width),a.y=d(a.y,b.y,c.height)}function i(a){return a>0?1:0>a?-1:0}function n(a,b){return Math.abs(a)>=2||Math.abs(b)>=2}function m(b,a){return 1e3==a?b:-1e3==a?-b:a}function d(a,c,b){return a+=c,0>a&&(a=b+a),a>=b&&(a-=b),a}function j(f,g){var d=0;return-1>=g&&(d|=e),g>=1&&(d|=c),-1>=f&&(d|=b),f>=1&&(d|=a),d}function f(a,b,c,d){null!=a&&(null==a.directions&&(a.directions={}),null==a.directions[b]&&(a.directions[b]={segment:c,unlikely:d}))}var k={up:{x:0,y:-1},left:{x:-1,y:0},right:{x:1,y:0},down:{x:0,y:1},"skip-up":{x:0,y:-2},"skip-left":{x:-2,y:0},"skip-right":{x:2,y:0},"skip-down":{x:0,y:2},horizontal:{x:1e3,y:-1e3},vertical:{x:-1e3,y:1e3},reverse:{x:-1e3,y:-1e3},none:{x:1e3,y:1e3}},e=1,c=2,b=4,a=8,h={up:e,down:c,left:b,right:a,horizontal:b|a,vertical:e|c,"up-left":e|b,"down-left":c|b,"up-right":e|a,"down-right":c|a},g={};Object.keys(h).forEach(function(a){g[h[a]]=a}),l.exports={map:k,bitMap:h,bitRevMap:g,process:o,calculate:m,move:d,convertToBits:j,write:f}},{}],4:[function(c,a,d){var b={initial:"ㄱㄲㄴㄷㄸㄹㅁㅂㅃㅅㅆㅇㅈㅉㅊㅋㅌㅍㅎ".split(""),medial:"ㅏㅐㅑㅒㅓㅔㅕㅖㅗㅘㅙㅚㅛㅜㅝㅞㅟㅠㅡㅢㅣ".split(""),"final":" ㄱㄲㄳㄴㄵㄶㄷㄹㄺㄻㄼㄽㄾㄿㅀㅁㅂㅄㅅㅆㅇㅈㅊㅋㅌㅍㅎ".split(""),code:44032};a.exports=b},{}],5:[function(c,x,w){function k(g){if(!g&&b)for(var c=0;c<a.map.height;++c)for(var d=0;d<a.map.width;++d){var e=a.map.get(d,c),i=b.cacheMap.get(d,c);e&&(e.directions={},e.segments={},i.directions={})}var j=a.map.width*a.map.height*2;f=new r(a.map);for(var h=0;j>h&&f.next();++h);!g&&b&&b.redraw()}function j(c){c||(a.reset(),b.reset()),document.getElementById("codeForm-output").value="",d.running=!1}function q(){return i?(h.renderer=b,e.renderer=b,g.renderer=b,d.renderer=b,void(d.interpreter=a)):(d=new m(a,b,function(){document.getElementById("codeForm-output").value+=a.shift(),document.getElementById("codeForm-debug").value=l.getStatus()},j.bind(this,!1)),h=new t(b),g=new n(document.getElementById("context-bg"),document.getElementById("context-push"),b),e=new u(document.getElementById("viewport"),h,b,g),e.checkCallback=function(){return!d.running},e.clickCallback=k.bind(this,!1),void(i=!0))}var a,b,f,l,h,e,g,d,o=c("./parser"),p=c("./renderer"),v=c("./interpreter"),r=c("./predictor"),s=c("./monitor"),t=c("./toolbox"),u=c("./viewport"),n=c("./contextmenu"),m=c("./playback"),i=!1;window.onload=function(){document.getElementById("codeForm").onsubmit=function(){var c=document.getElementById("codeForm-code").value;return a=new v(c),l=new s(a),k(!0),b=new p(document.getElementById("canvas"),a),q(),window.interpreter=a,window.predictor=f,j(!0),!1},document.getElementById("codeForm-export").onclick=function(){document.getElementById("codeForm-code").value=o.encode(a.map)}}},{"./contextmenu":2,"./interpreter":6,"./monitor":9,"./parser":10,"./playback":11,"./predictor":12,"./renderer":13,"./toolbox":17,"./viewport":18}],6:[function(d,f,i){function a(a){return{data:2,exec:function(e,f,b){var c=b.pull(),d=b.pull();b.push(a(c,d))}}}function b(a){"string"==typeof a?this.map=g.parse(a):this.map=a,this.reset()}var g=d("./parser"),e=d("./memory"),c=d("./direction"),h={end:{data:0,exec:function(b,a,c){a.running=!1}},add:a(function(a,b){return b+a}),multiply:a(function(a,b){return b*a}),subtract:a(function(a,b){return b-a}),divide:a(function(a,b){return b/a|0}),mod:a(function(a,b){return b%a}),pop:{data:1,exec:function(b,c,a){a.pull()}},"pop-unicode":{data:1,exec:function(d,a,b){var c=b.pull();a.output.push(String.fromCharCode(c))}},"pop-number":{data:1,exec:function(d,a,b){var c=b.pull();a.output=a.output.concat(String(c).split(""))}},push:{data:0,exec:function(a,c,b){b.push(a.data)}},"push-unicode":{data:0,exec:function(b,c,a){a.push(44032)}},"push-number":{data:0,exec:function(b,c,a){a.push(123)}},copy:{data:1,exec:function(b,c,a){a.copy()}},flip:{data:2,exec:function(b,c,a){a.flip()}},select:{data:0,exec:function(a,b,c){b.selected=a.data}},move:{data:1,exec:function(a,b,c){var d=b.memory[a.data],e=c.pull();d.push(e)}},compare:{data:2,exec:function(d,e,a){var b=a.pull(),c=a.pull();a.push(c>=b?1:0)}},condition:{data:1,exec:function(c,d,a){var b=a.pull();return 0===b?!0:void 0}}};b.prototype.push=function(a){},b.prototype.shift=function(){var a=this.state.output.join("");return this.state.output=[],a},b.prototype.reset=function(){this.state={x:0,y:0,direction:{x:0,y:1},memory:{},selected:0,input:[],output:[],running:!0},this.updated=[];for(var a=0;28>a;++a)switch(a){case 21:this.state.memory[a]=new e.Queue;break;case 28:this.state.memory[a]=new e.Stack;break;default:this.state.memory[a]=new e.Stack}},b.prototype.next=function(){if(!this.state.running)return!1;var a=this.state.direction,i=c.convertToBits(-a.x,-a.y),b=this.map.get(this.state.x,this.state.y),e=!1;if(null!==b){var f=c.map[b.direction];a.x=c.calculate(a.x,f.x),a.y=c.calculate(a.y,f.y);var j=this.state.selected,g=this.state.memory[j],d=h[b.command];d&&(e=g.canPull(d.data)?!!d.exec(b,this.state,g):!0)}return this.state.running?(e&&(a.x*=-1,a.y*=-1),c.process(this.state,this.map,a,i,this.updated,0),this.state.running):!1},f.exports=b},{"./direction":3,"./memory":8,"./parser":10}],7:[function(f,c,g){function a(a){this.toolbox=a,this.registerEvents()}var d=["qwert","asdfg","zxcvb"].map(function(a){return a.split("")}),e=["qwertQWERT","asdfgASDFG","zxcvbZXCVBN"].map(function(a){return a.split("")}),b={q:["arrow","none"],w:["arrow","up"],e:["command","none"],r:["command","select"],t:["command","move"],a:["arrow","left"],s:["arrow","down"],d:["arrow","right"],f:["command","push"],g:["command","pop"],z:["command","subtract"],x:["command","divide"],c:["command","add"],v:["command","multiply"],b:["command","mod"],Q:["arrow","reverse"],W:["arrow","skip-up"],E:["command","end"],R:["command","condition"],T:["command","compare"],A:["arrow","skip-left"],S:["arrow","skip-down"],D:["arrow","skip-right"],F:["command","copy"],G:["command","flip"],Z:["arrow","horizontal"],X:["arrow","vertical"],C:["command","pop-number"],V:["command","pop-unicode"],B:["command","push-unicode"],N:["command","push-number"]};a.prototype.registerEvents=function(){var a=this;document.addEventListener("keypress",function(c){var d=c.key||String.fromCharCode(c.charCode);if(b[d]){var e=b[d];a.toolbox.changeSelected(e[0],e[1])}})},a.KeyLayout=d,a.KeyShiftLayout=e,a.KeyMapping=b,c.exports=a},{}],8:[function(e,d,f){function a(){}function b(){this.data=[]}function c(){this.data=[]}a.prototype.push=function(a){},a.prototype.pull=function(){},a.prototype.canPull=function(a){},a.prototype.copy=function(){},a.prototype.flip=function(){},b.prototype.push=function(a){this.data.push(a)},b.prototype.pull=function(){return this.data.pop()},b.prototype.canPull=function(a){return this.data.length>=a},b.prototype.copy=function(){if(!this.canPull(1))return!1;var a=this.pull();return this.data.push(a),this.data.push(a),!0},b.prototype.flip=function(){if(!this.canPull(2))return!1;var a=this.pull(),b=this.pull();return this.data.push(a),this.data.push(b),!0},c.prototype.push=function(a){this.data.push(a)},c.prototype.pull=function(){return this.data.shift()},c.prototype.canPull=function(a){return this.data.length>=a},c.prototype.copy=function(){if(!this.canPull(1))return!1;var a=this.data[0];return this.data.unshift(a),!0},c.prototype.flip=function(){if(!this.canPull(2))return!1;var a=this.pull(),b=this.pull();return this.data.unshift(b),this.data.unshift(a),!0},d.exports.Memory=a,d.exports.Stack=b,d.exports.Queue=c},{}],9:[function(b,c,e){function a(a){this.interpreter=a}var d=b("./hangul");a.prototype.getStatus=function(){var a="",b=this.interpreter.state;if(b.running){b.direction;a+="실행 중 (위치 "+b.x+", "+b.y+")\n"}else a+="실행 끝\n";for(var c=0;28>c;++c)b.selected==c&&(a+=">> "),a+=d["final"][c]+": ",a+=b.memory[c].data.join(" "),a+="\n";return a},c.exports=a},{"./hangul":4}],10:[function(f,b,p){function n(a){return a>=44032&&55203>=a}function i(h){var b={direction:"none",command:"none",original:h},f=h.charCodeAt();if(!n(f))return b;f-=a.code;var i=f%a["final"].length,g=a["final"][i];f=f/a["final"].length|0;var j=f%a.medial.length,k=a.medial[j];f=f/a.medial.length|0;var l=f%a.initial.length,m=a.initial[l];return b.direction=e[k]||b.direction,b.command=d[m]||b.command,"push"==b.command&&("ㅇ"==g?b.command="push-number":"ㅎ"==g?b.command="push-unicode":b.data=c[g]),"pop"==b.command&&("ㅇ"==g?b.command="pop-number":"ㅎ"==g&&(b.command="pop-unicode")),("select"==b.command||"move"==b.command)&&(b.data=i),b}function m(b){var d=h[b.command],f=g[b.direction],c=" ";"push-number"==b.command?(d="ㅂ",c="ㅇ"):"push-unicode"==b.command?(d="ㅂ",c="ㅎ"):"push"==b.command?c=j[b.data||0]:"pop-number"==b.command?(d="ㅁ",c="ㅇ"):"pop-unicode"==b.command?(d="ㅁ",c="ㅎ"):("select"==b.command||"move"==b.command)&&(c=a["final"][b.data||0]);var i=a.initial.indexOf(d),k=a.medial.indexOf(f),l=a["final"].indexOf(c),e=a.code;return e+=i*a.medial.length*a["final"].length,e+=k*a["final"].length,e+=l,String.fromCharCode(e)}function l(a){for(var b="",c=0;c<a.height;++c){for(var d=0;d<a.width;++d){var e=a.get(d,c);b+=e?e.original:"ㅇ"}b+="\n"}return b.slice(0,-1)}function k(f){for(var c=f.split("\n"),d=new o(0,c.length),a=0;a<c.length;++a){var e=c[a].split("");d.expand(e.length,0);for(var b=0;b<e.length;++b)d.set(b,a,i(e[b]))}return d}var o=f("./tilemap"),a=f("./hangul"),e={"ㅗ":"up","ㅓ":"left","ㅏ":"right","ㅜ":"down","ㅛ":"skip-up","ㅕ":"skip-left","ㅑ":"skip-right","ㅠ":"skip-down","ㅡ":"horizontal","ㅣ":"vertical","ㅢ":"reverse","ㅐ":"none"},g={};Object.keys(e).forEach(function(a){g[e[a]]=a});var d={"ㅇ":"none","ㅎ":"end","ㄷ":"add","ㄸ":"multiply","ㅌ":"subtract","ㄴ":"divide","ㄹ":"mod","ㅁ":"pop","ㅂ":"push","ㅃ":"copy","ㅍ":"flip","ㅅ":"select","ㅆ":"move","ㅈ":"compare","ㅊ":"condition"},h={};Object.keys(d).forEach(function(a){h[d[a]]=a});var c={" ":0,"ㄱ":2,"ㄴ":2,"ㄷ":3,"ㄹ":5,"ㅁ":4,"ㅂ":4,"ㅅ":2,"ㅈ":3,"ㅊ":4,"ㅋ":3,"ㅌ":4,"ㅍ":4,"ㄲ":4,"ㄳ":4,"ㄵ":5,"ㄶ":5,"ㄺ":7,"ㄻ":9,"ㄼ":9,"ㄽ":7,"ㄾ":9,"ㄿ":9,"ㅀ":8,"ㅄ":6,"ㅆ":4},j={};Object.keys(c).forEach(function(a){j[c[a]]=a}),b.exports.parseSyllable=i,b.exports.parse=k,b.exports.encodeSyllable=m,b.exports.encode=l},{"./hangul":4,"./tilemap":16}],11:[function(c,b,d){function a(a,b,c,d){this.interpreter=a,this.renderer=b,this.callback=c,this.resetCallback=d,this.running=!1,this.registerEvents()}a.prototype.registerEvents=function(){var a=this;document.getElementById("codeForm-resume").onclick=function(){a.running=!0},document.getElementById("codeForm-pause").onclick=function(){a.running=!1},document.getElementById("codeForm-step").onclick=function(){a.step(),a.running=!1},document.getElementById("codeForm-reset").onclick=function(){a.resetCallback()},setInterval(function(){a.running&&a.step()},20)},a.prototype.step=function(){this.interpreter&&this.renderer&&(this.interpreter.next(),this.renderer.render(),this.callback&&this.callback())},b.exports=a},{}],12:[function(b,d,h){function c(a){"string"==typeof a?this.map=e.parse(a):this.map=a,this.segmentId=0,this.segments={},this.stack=[{x:0,y:0,direction:{x:0,y:1},register:{x:0,y:0,preDir:0}}],this.updated=[]}var e=b("./parser"),a=b("./direction"),f={condition:!0,add:!0,multiply:!0,subtract:!0,divide:!0,mod:!0,pop:!0,"pop-unicode":!0,"pop-number":!0,copy:!0,flip:!0,move:!0,compare:!0},g={add:!0,multiply:!0,subtract:!0,divide:!0,mod:!0,pop:!0,"pop-unicode":!0,"pop-number":!0,copy:!0,flip:!0,move:!0,compare:!0};c.prototype.next=function(){if(0===this.stack.length)return!1;var b=this.stack[this.stack.length-1];b.register&&(b.segment=this.segmentId++,this.segments[b.segment]=[],b.register.preDir&&a.process(b.register,this.map,b.direction,b.register.preDir,this.updated,b.segment,b.unlikely),delete b.register);var e=this.segments[b.segment],c=b.direction,m=a.convertToBits(-c.x,-c.y),d=this.map.get(b.x,b.y),k=!1;if(e&&e.push(d),null!==d){d.segments||(d.segments={});var o=a.map[d.direction];if(c.x=a.calculate(c.x,o.x),c.y=a.calculate(c.y,o.y),"end"==d.command&&(k=!0),d.segments[a.convertToBits(c.x,c.y)]?k=!0:d.segments[a.convertToBits(c.x,c.y)]={segment:b.segment,position:e?e.length-1:0},!k&&f[d.command]){var h={x:-c.x,y:-c.y},i={x:a.move(b.x,h.x,this.map.width),y:a.move(b.y,h.y,this.map.height),direction:h,unlikely:b.unlikely,register:{x:b.x,y:b.y,preDir:m}},j=this.map.get(i.x,i.y),n=!1;if(j){var l=a.map[j.direction];l.x==c.x&&l.y==c.y&&(n=!0)}n||j&&j.segments&&j.segments[a.convertToBits(h.x,h.y)]||(g[d.command]?(i.unlikely=!0,this.stack.unshift(i)):this.stack.push(i))}}return a.process(b,this.map,c,m,this.updated,b.segment,b.unlikely),k&&(this.stack.splice(this.stack.indexOf(b),1),e&&e.length<=1&&delete this.segments[b.segment]),this.stack.length>0},d.exports=c},{"./direction":3,"./parser":10}],13:[function(b,g,l){function d(a,b,c,e,f,d,h,g){"undefined"==typeof g&&(g=!0),"undefined"==typeof d&&(d=5),a.beginPath(),a.moveTo(b+d,c),a.lineTo(b+e-d,c),a.quadraticCurveTo(b+e,c,b+e,c+d),a.lineTo(b+e,c+f-d),a.quadraticCurveTo(b+e,c+f,b+e-d,c+f),a.lineTo(b+d,c+f),a.quadraticCurveTo(b,c+f,b,c+f-d),a.lineTo(b,c+d),a.quadraticCurveTo(b,c,b+d,c),a.closePath(),g&&a.stroke(),h&&a.fill()}var e=b("./tilemap"),f=b("./canvaslayer"),c=b("./hangul"),h={up:[2,0],left:[2,1],right:[3,0],down:[3,1],"skip-up":[2,2],"skip-left":[2,3],"skip-right":[3,2],"skip-down":[3,3],none:[0,0],horizontal:[1,0],vertical:[1,1],reverse:[0,1]},i={up:[2,1],left:[1,2],right:[3,0],down:[2,2],"up-left":[1,1],"up-right":[0,2],"down-left":[2,0],"down-right":[0,0],horizontal:[1,0],vertical:[0,1],"skip-horizontal":[3,1],"skip-vertical":[3,2]},j=[[0,0],[1,0],[0,1],[1,1]],k={none:[0,0],end:[1,0],add:[2,0],multiply:[3,0],subtract:[2,1],divide:[3,1],mod:[1,1],push:[0,1],"push-unicode":[4,1],"push-number":[4,0],pop:[0,2],"pop-unicode":[4,3],"pop-number":[4,2],copy:[1,2],flip:[2,2],select:[3,2],move:[0,3],compare:[1,3],condition:[2,3]},a=function(i,a,j){function b(){h--,0===h&&k.reset()}this.interpreter=a,this.map=a.map,this.width=j||50,this.canvases=new f(i,["background","highlight","text","path","arrow","command"],this.width*a.map.width,this.width*a.map.height);var h=4,k=this,c=new Image;c.src="img/path.png",c.onload=b,this.pathImage=c;var d=new Image;d.src="img/path_transparent.png",d.onload=b,this.pathTransparentImage=d;var e=new Image;e.src="img/arrow.png",e.onload=b,this.arrowImage=e;var g=new Image;g.src="img/command.png",g.onload=b,this.commandImage=g};a.prototype.reset=function(){this.cacheMap=new e(this.interpreter.map.width,this.interpreter.map.height),this.canvases.setSize(this.width*this.interpreter.map.width,this.width*this.interpreter.map.height),this.canvases.forEach(function(a){a.font=.6*this.width+"px sans-serif",a.textAlign="center",a.textBaseline="middle",a.fillStyle="#000"},this),this.canvases.get("background").fillRect(0,0,this.canvases.width,this.canvases.height),this.canvases.get("text").fillStyle="#555";for(var a=0;a<this.interpreter.map.height;++a)for(var b=0;b<this.interpreter.map.width;++b)this.cacheMap.set(b,a,{}),this.updateTile(b,a)},a.prototype.redraw=function(){for(var a=0;a<this.interpreter.map.height;++a)for(var b=0;b<this.interpreter.map.width;++b)this.updateTile(b,a)},a.prototype.updateTile=function(f,l){var o=this.interpreter.state,a=this.interpreter.map.get(f,l),b=this.cacheMap.get(f,l);if(a){this.canvases.forEach(function(a){a.save(),a.translate(f*this.width,l*this.width)},this);var n=o&&o.x==f&&o.y==l;if(b.highlighted!=n){b.highlighted=n;var m=this.canvases.get("highlight");m.clearRect(0,0,this.width,this.width),n?m.fillStyle="#666":m.fillStyle="#222",d(m,1,1,this.width-2,this.width-2,4,!0)}if(b.text!=a.original){b.text=a.original;var q=this.canvases.get("text");q.clearRect(0,0,this.width,this.width),q.fillText(a.original,this.width/2,this.width/2)}if(a.directions&&b.directions!=Object.keys(a.directions).length){b.directions=Object.keys(a.directions).length,this.canvases.get("path").clearRect(0,0,this.width,this.width);for(var p in a.directions){var r=j[a.directions[p].segment%4],s=i[p],t=this.pathImage;a.directions[p].unlikely&&(t=this.pathTransparentImage),this.canvases.get("path").drawImage(t,100*(4*r[0]+s[0]),100*(3*r[1]+s[1]),100,100,0,0,this.width,this.width)}}if(b.direction!=a.direction){b.direction=a.direction;var u=this.canvases.get("arrow");u.clearRect(0,0,this.width,this.width);var v=h[a.direction];u.drawImage(this.arrowImage,100*v[0],100*v[1],100,100,0,0,this.width,this.width)}if(b.command!=a.command||b.data!=a.data){b.command=a.command,b.data=a.data;var e=this.canvases.get("command"),w=k[a.command];if(e.clearRect(0,0,this.width,this.width),e.drawImage(this.commandImage,100*w[0],100*w[1],100,100,0,0,this.width,this.width),null!=a.data){var g="";"push"==a.command&&(g=a.data),"select"==a.command&&(g=c["final"][a.data]),"move"==a.command&&(g=c["final"][a.data]),e.font=.3*this.width+"px sans-serif",e.textAlign="right",e.textBaseline="bottom",e.fillStyle="#fff",e.fillText(g,this.width-3,this.width-3)}}this.canvases.forEach(function(a){a.restore()},this)}},a.prototype.render=function(){for(var a=this.interpreter.state;this.interpreter.updated.length>0;){var b=this.interpreter.updated.shift();this.updateTile(b.x,b.y)}a&&this.updateTile(a.x,a.y)},g.exports=a},{"./canvaslayer":1,"./hangul":4,"./tilemap":16}],14:[function(c,b,d){function a(a,b){this.viewport=a,this.clickCallback=b,this.registerEvents()}a.prototype.registerEvents=function(){function f(b){return document.removeEventListener("mouseup",f),document.removeEventListener("mousemove",g),Math.abs(d)<6&&Math.abs(e)<6&&a.clickCallback&&a.clickCallback(b),!1}function g(f){var g=f.pageX-b,h=f.pageY-c;a.viewport.scrollTop-=h,a.viewport.scrollLeft-=g,d-=g,e-=h,b=f.pageX,c=f.pageY}var a=this,b=0,c=0,d=0,e=0;this.viewport.addEventListener("mousedown",function(a){return b=a.pageX,c=a.pageY,d=0,e=0,document.addEventListener("mouseup",f),document.addEventListener("mousemove",g),a.preventDefault(),!1})},b.exports=a},{}],15:[function(b,c,e){function a(a,b,c){this.viewport=a,this.tilemap=b,this.updateCallback=c,this.reset()}var d=b("./tilemap");a.prototype.reset=function(){this.domMap=new d(this.tilemap.width,this.tilemap.height),this.createNodes()},a.prototype.createNodes=function(){for(;this.viewport.firstChild;)this.viewport.removeChild(this.viewport.firstChild);for(var a=0;a<this.domMap.height;++a){var d=document.createElement("tr");this.viewport.appendChild(d);for(var b=0;b<this.domMap.width;++b){var c=document.createElement("td");d.appendChild(c),c.tx=b,c.ty=a,this.domMap.set(b,a,c),this.updateNode(b,a)}}},a.prototype.updateNode=function(a,b){var c=this.domMap.get(a,b),d=this.tilemap.get(a,b);this.updateCallback(c,d,a,b)},c.exports=a},{"./tilemap":16}],16:[function(c,b,d){function a(a,b){this.width=a,this.height=b,this.map=null,this.clear()}a.prototype.clear=function(){this.map=[];for(var a=0;a<this.height;++a){for(var c=[],b=0;b<this.width;++b)c[b]=null;this.map[a]=c}},a.prototype.expand=function(d,e){var a,b,c,g=this.width,f=this.height;for(d>this.width&&(this.width=d),e>this.height&&(this.height=e),b=0;f>b;++b)for(c=this.map[b],a=g;a<this.width;++a)c[a]=null;for(b=f;b<this.height;++b){for(c=[],a=0;a<this.width;++a)c[a]=null;this.map[b]=c}},a.prototype.get=function(a,b){return 0>b||b>=this.height?null:0>a||a>=this.width?null:this.map[b][a]},a.prototype.set=function(a,b,c){if(0>b||b>=this.height)throw new Error("TileMap out of bounds");if(0>a||a>=this.width)throw new Error("TileMap out of bounds");this.map[b][a]=c},b.exports=a},{}],17:[function(a,d,g){function b(a){this.selected={type:"arrow",name:"none"},this.oldNode=null,this.renderer=a,this.scrollPane=null,this.keyboard=new c(this),this.generateTable()}var c=a("./keyboard"),e=a("./tilemap"),f=a("./table");b.prototype.generateTable=function(){for(var g=this,a=new e(11,3),b=0;b<a.height;++b)for(var d=0;d<a.width;++d){var h=c.KeyShiftLayout[b][d];a.set(d,b,{value:c.KeyMapping[h],key:h})}var i=document.getElementById("toolbox-table");this.table=new f(i,a,function(a,b){return b&&b.value?(a.id=b.value.join("-"),a.className=b.value[0],a.appendChild(document.createTextNode(b.key)),void a.addEventListener("click",function(){g.changeSelected.apply(g,b.value)})):void a.parentNode.removeChild(a)})},b.prototype.changeSelected=function(a,b){this.oldNode&&(this.oldNode.className=this.selected.type),this.selected.type=a,this.selected.name=b;var c=document.getElementById(a+"-"+b);c.className=a+" selected",this.oldNode=c},d.exports=b},{"./keyboard":7,"./table":15,"./tilemap":16}],18:[function(b,c,f){function a(a,b,c,e,f,g){this.element=a,this.toolbox=b,this.renderer=c,this.contextmenu=e,this.scrollpane=new d(a,this.handleMouseClick.bind(this)),this.checkCallback=f,this.clickCallback=g,this.hookEvents()}var d=b("./scrollpane"),e=b("./parser");a.prototype.hookEvents=function(){this.element.addEventListener("contextmenu",this.handleContext.bind(this))},a.prototype.handleMouseClick=function(g){var h=0,f=0,k=0,j=0,d=this.element;do h+=d.offsetLeft-d.scrollLeft,f+=d.offsetTop-d.scrollTop,d=d.offsetParent;while(d);h+=this.renderer.canvases.viewport.offsetLeft,f+=this.renderer.canvases.viewport.offsetTop,h+=document.body.scrollLeft,f+=document.body.scrollTop,k=g.pageX-h,j=g.pageY-f,g.preventDefault();var a=k/this.renderer.width|0,b=j/this.renderer.width|0;if(!this.checkCallback(a,b))return!1;this.renderer.map.expand(a+1,b+1),(a+1>=this.renderer.map.width||b+1>=this.renderer.map.height)&&this.renderer.reset();var c=this.renderer.map.get(a,b)||{direction:"none",command:"none",original:" "};if(0==g.button){var i=this.toolbox.selected;"arrow"==i.type?c.direction=i.name:c.command=i.name,c.original=e.encodeSyllable(c),this.renderer.map.set(a,b,c),this.renderer.updateTile(a,b),this.clickCallback(a,b,c)}else if(2==g.button){var l=a*this.renderer.width+h,m=(b+1)*this.renderer.width+f;this.contextmenu.tileX=a,this.contextmenu.tileY=b,this.contextmenu.tile=c,this.contextmenu.show(l,m)}},a.prototype.handleContext=function(a){return a.preventDefault(),!1},c.exports=a},{"./parser":10,"./scrollpane":14}]},{},[5]);
//# sourceMappingURL=aheuichem.min.js.map